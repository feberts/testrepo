<div id="pdfViewer"></div>
<script src="PdfTeXEngine.js"></script>
<script>
async function compile()
{
    const engine = new PdfTeXEngine();
    console.log("loading engine");
    await engine.loadEngine();

    console.log("setting TexLive endpoint");
    engine.setTexliveEndpoint("http://tex.feb-dev.net:4711/");

    if(!engine.isReady())
    {
        console.log("engine is not ready");
        return;
    }

    console.log("engine is ready");

    console.log("setup TeX files");
    let texRaw = await fetch('test.tex');
    let tex = await texRaw.text();
    engine.writeMemFSFile("main.tex", tex);
    engine.setEngineMainFile("main.tex");

    console.log("compiling document");
    let result = await engine.compileLaTeX();
    console.log(result.log);

    console.log("display pdf");
    const pdfblob = new Blob([result.pdf], {type : 'application/pdf'});
    const objectURL = URL.createObjectURL(pdfblob);
    setTimeout(()=>{URL.revokeObjectURL(objectURL);}, 30000);
    const pdfViewer = document.getElementById("pdfViewer");
    pdfViewer.innerHTML = `<embed src="${objectURL}" width="100%" height="100%" type="application/pdf">`;
}

compile();
</script>
